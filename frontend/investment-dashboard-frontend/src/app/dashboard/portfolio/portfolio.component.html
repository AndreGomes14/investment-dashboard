<div class="loading-container" *ngIf="isLoading">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Loading Portfolio Data...</p>
</div>

<div *ngIf="!isLoading && !hasPortfolioData" class="no-data-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Portfolio Not Set Up</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p>You currently have no portfolio or investments setup.</p>
      <p>Please go to the <strong>Investment Management</strong> tab to create a portfolio and add your first investments.</p>
    </mat-card-content>
  </mat-card>
</div>

<div class="portfolio-container" *ngIf="!isLoading && hasPortfolioData">
  <div class="page-header">
    <h1>Portfolio Overview</h1>
    <p class="subtitle" *ngIf="portfolios && portfolios.length > 0">{{ portfolios[0].name }}</p>
  </div>

  <div class="metrics-row">
    <mat-card class="metric-card">
      <mat-card-header>
        <mat-icon mat-card-avatar class="metric-icon">account_balance</mat-icon>
        <mat-card-title>Total Value</mat-card-title>
        <mat-card-subtitle>Current Holdings</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <h2 class="metric-value">{{ totalPortfolioValue | currency:'USD':'symbol':'1.2-2' }}</h2>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-header>
        <mat-icon mat-card-avatar class="metric-icon">trending_up</mat-icon>
        <mat-card-title>Total Gain/Loss</mat-card-title>
        <mat-card-subtitle>Overall Return</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <h2 class="metric-value" [ngClass]="totalGainLoss >= 0 ? 'positive' : 'negative'">
          {{ totalGainLoss | currency:'USD':'symbol':'1.2-2' }}
        </h2>
        <div class="metric-change" [ngClass]="totalGainLoss >= 0 ? 'positive' : 'negative'">
          <mat-icon>{{ totalGainLoss >= 0 ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
          <span>{{ totalGainLossPercentage | number:'1.1-2' }}% overall</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-header>
        <mat-icon mat-card-avatar class="metric-icon">pie_chart</mat-icon>
        <mat-card-title>Asset Allocation</mat-card-title>
        <mat-card-subtitle>Current Distribution</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="allocation-chart">
          <div class="allocation-item" style="width: 65%; background-color: #3949ab;">
            <span>Stocks: 65%</span>
          </div>
          <div class="allocation-item" style="width: 20%; background-color: #43a047;">
            <span>Bonds: 20%</span>
          </div>
          <div class="allocation-item" style="width: 10%; background-color: #ff9800;">
            <span>Cash: 10%</span>
          </div>
          <div class="allocation-item" style="width: 5%; background-color: #e53935;">
            <span>Other: 5%</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="holdings-section">
    <div class="section-header">
      <h2>Your Holdings</h2>
      <button mat-raised-button color="primary" routerLink="../investments">
        <mat-icon>add</mat-icon>
        Manage Investments
      </button>
    </div>

    <mat-card *ngIf="!investments || investments.length === 0">
      <mat-card-content>
        <p class="info-message">No investments found in this portfolio. Go to 'Investment Management' to add some.</p>
      </mat-card-content>
    </mat-card>

    <mat-card *ngIf="investments && investments.length > 0">
      <div class="table-responsive">
        <table class="holdings-table">
          <thead>
          <tr>
            <th>Asset (Ticker)</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Purchase Price</th>
            <th>Current Value</th>
            <th>Total Value</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let investment of investments">
            <td>{{ investment.ticker }}</td>
            <td>{{ investment.type }}</td>
            <td>{{ investment.amount | number }}</td>
            <td>{{ investment.purchasePrice | currency:investment.currency:'symbol':'1.2-2' }}</td>
            <td>{{ (investment.currentValue ?? 0) | currency:investment.currency:'symbol':'1.2-2' }}</td>
            <td>{{ ((investment.currentValue ?? 0) * investment.amount) | currency:investment.currency:'symbol':'1.2-2' }}</td>
          </tr>
          </tbody>
        </table>
      </div>
    </mat-card>
  </div>
</div>
